___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "displayName": "Snowplow v4",
  "description": "Load, configure, and deploy the Snowplow JavaScript tracker library (v4).",
  "__wm": "VGVtcGxhdGUtQXV0aG9yX1Nub3dwbG93QW5hbHl0aWNzVjNUYWctU2ltby1BaGF2YQ\u003d\u003d",
  "securityGroups": [],
  "categories": [
    "ANALYTICS"
  ],
  "id": "cvt_temp_public_id",
  "type": "TAG",
  "version": 1,
  "brand": {
    "displayName": "snowplow",
    "id": "github.com_snowplow",
    "thumbnail": "data:image/png;base64,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jQB7s1+193/x9WGk2qpIZHb3Lnds1fNk5KV/kUpBxT1kgI3r/uzxs3/6w4u5yf8lfRGrSASd9//LxPHp2YdVG9b92aOX/vW/mtXzlOEQrdg0LX6esp9/8Zd/8l1825872wwwk5tMVB/tnf77//4/Xnv87B83ov88g4ddmIFYLD0wnERKIpciMpKyDWvnE/XVGfEyZGaCQ38PU5faq1z5OReLAzJjUwkkE1vOf/1Pb9Xx4NweDCCWSw3cTJ4dvMU0kqx3u6stzlbtduEhuuVSrbvS6CVDItNce/tAM4OHfV4I+gGodMnWxvRCZCHCTIRsxMzDXjxEd0TxYPZ//u//8+ff/dP/Wxv08xCtJlqxcfqb90/+222V/2Yq6GchNTwDccz0tw+jJ85/ehFplU3ktzMtO1Op1l28KGg5BhBH9Wa/au/88HP2ESKj8B6SWxhAHIdedCPSJdnSmGJ7ErcwgITA9LcPo/1ffH34vetsLU7+EhnHa9v/8stDu7f3h+EGftgwgIRMJjeZ+P3fTfyGZySkU1N9deY3f113kdVVbmMACam5x0/LJvIP6jKF7a2J/INald5aRNGKjdPRik35qopN09GKjflErEZ6eibZjQGEiIiU8CY6EREpYQAhIiIlDCBERKSEAYSIiJQwgBARkRIGECIiUsIAQkREShhAiIhICQMIEREpYQAhIiIlDCBERKSEAYSIiJQwgBARkRIGECIiUsIAQkREShhAiIhICQMIEREpYQAhIiIlDCBERKSEAYSIiJQwgBARkRIGECIiUsIAQkREShhAiIhICQMIEREpYQAhIiIlDCBERKSEAYSIiJQwgBARkRIGECIiUsIAQkREShhAiIhICQMIEREpYQAhIiIlDCBERKSEAYSIiJQwgBARkRIGECIiUsIAQkREShhAiIhICQMIEREpYQAhIiIlDCBERKSEAYSIiJQwgBARkRIGECIiUsIAQkREShhAiIhICQMIEREpYQAhIiIlDCBERKSEAYSIiJT8/wAAAP//k6HgDMXTtssAAAAASUVORK5CYII\u003d"
  },
  "containerContexts": [
    "WEB"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "help": "Choose the type of event you want to send or [Custom command] to select from a list of available tracker commands.",
    "selectItems": [
      {
        "displayValue": "Ad Tracking",
        "value": "adTracking"
      },
      {
        "value": "enableButtonClickTracking",
        "displayValue": "Button Click Tracking"
      },
      {
        "displayValue": "Cart Tracking",
        "value": "cartTracking"
      },
      {
        "displayValue": "Enhanced Consent",
        "value": "trackConsent"
      },
      {
        "displayValue": "Enhanced Ecommerce",
        "value": "enhancedEcommerce"
      },
      {
        "displayValue": "Error Tracking",
        "value": "trackError"
      },
      {
        "displayValue": "Form Tracking",
        "value": "formTracking"
      },
      {
        "displayValue": "Link Click Tracking",
        "value": "linkTracking"
      },
      {
        "displayValue": "Page View",
        "value": "trackPageView"
      },
      {
        "displayValue": "Self-describing Event",
        "value": "trackSelfDescribingEvent"
      },
      {
        "displayValue": "Site Search",
        "value": "trackSiteSearch"
      },
      {
        "displayValue": "Social Interaction",
        "value": "trackSocialInteraction"
      },
      {
        "displayValue": "Structured Event",
        "value": "trackStructEvent"
      },
      {
        "displayValue": "Timing",
        "value": "trackTiming"
      },
      {
        "displayValue": "[Custom Command]",
        "value": "customCommand"
      }
    ],
    "displayName": "Tag Type",
    "defaultValue": "trackPageView",
    "simpleValueType": true,
    "name": "eventType",
    "type": "SELECT"
  },
  {
    "help": "Choose a Google Tag Manager variable that returns an object of key-value pairs that will then be encoded as the parameters for this hit. Select \"No\" if you want to add the parameters manually.",
    "macrosInSelect": true,
    "selectItems": [
      {
        "displayValue": "No",
        "value": "no"
      }
    ],
    "displayName": "Retrieve Parameters From Variable",
    "simpleValueType": true,
    "name": "paramsFromVariable",
    "type": "SELECT",
    "enablingConditions": [
      {
        "paramName": "eventType",
        "paramValue": "adTracking",
        "type": "EQUALS"
      },
      {
        "paramName": "eventType",
        "paramValue": "cartTracking",
        "type": "EQUALS"
      },
      {
        "paramName": "eventType",
        "paramValue": "trackError",
        "type": "EQUALS"
      },
      {
        "paramName": "eventType",
        "paramValue": "trackSelfDescribingEvent",
        "type": "EQUALS"
      },
      {
        "paramName": "eventType",
        "paramValue": "trackSiteSearch",
        "type": "EQUALS"
      },
      {
        "paramName": "eventType",
        "paramValue": "trackSocialInteraction",
        "type": "EQUALS"
      },
      {
        "paramName": "eventType",
        "paramValue": "trackStructEvent",
        "type": "EQUALS"
      },
      {
        "paramName": "eventType",
        "paramValue": "trackTiming",
        "type": "EQUALS"
      }
    ]
  },
  {
    "enablingConditions": [
      {
        "paramName": "eventType",
        "type": "EQUALS",
        "paramValue": "trackStructEvent"
      }
    ],
    "name": "structEventConfig",
    "type": "GROUP",
    "subParams": [
      {
        "type": "GROUP",
        "name": "structEvent",
        "displayName": "Structured Event",
        "subParams": [
          {
            "name": "structEventParams",
            "simpleTableColumns": [
              {
                "selectItems": [
                  {
                    "displayValue": "category (required)",
                    "value": "category"
                  },
                  {
                    "displayValue": "action (required)",
                    "value": "action"
                  },
                  {
                    "displayValue": "label",
                    "value": "label"
                  },
                  {
                    "displayValue": "property",
                    "value": "property"
                  },
                  {
                    "displayValue": "value",
                    "value": "value"
                  }
                ],
                "defaultValue": "category",
                "displayName": "Parameter Name",
                "name": "name",
                "isUnique": true,
                "type": "SELECT"
              },
              {
                "defaultValue": "",
                "displayName": "Parameter Value",
                "name": "value",
                "type": "TEXT"
              }
            ],
            "type": "SIMPLE_TABLE",
            "newRowButtonText": "Add Parameter"
          }
        ],
        "help": "\u003ca href\u003d\"https://docs.snowplow.io/docs/collecting-data/collecting-from-own-applications/javascript-trackers/javascript-tracker/javascript-tracker-v3/tracking-events/#tracking-custom-structured-events\"\u003eRead more\u003c/a\u003e about Structured Events.",
        "enablingConditions": [
          {
            "paramName": "paramsFromVariable",
            "paramValue": "no",
            "type": "EQUALS"
          }
        ]
      }
    ]
  },
  {
    "help": "\u003ca href\u003d\"https://docs.snowplow.io/docs/collecting-data/collecting-from-own-applications/javascript-trackers/javascript-tracker/javascript-tracker-v3/tracking-events/#tracking-custom-self-describing-events\"\u003eRead more\u003c/a\u003e about Self-describing Events.",
    "enablingConditions": [
      {
        "paramName": "eventType",
        "type": "EQUALS",
        "paramValue": "trackSelfDescribingEvent"
      }
    ],
    "displayName": "Self-describing Event",
    "name": "selfDescribingEventConfig",
    "groupStyle": "NO_ZIPPY",
    "type": "GROUP",
    "subParams": [
      {
        "valueValidators": [
          {
            "type": "NON_EMPTY"
          }
        ],
        "displayName": "Schema URL",
        "simpleValueType": true,
        "name": "selfDescribingEventSchemaUrl",
        "type": "TEXT"
      },
      {
        "enablingConditions": [
          {
            "paramName": "paramsFromVariable",
            "type": "EQUALS",
            "paramValue": "no"
          }
        ],
        "name": "selfDescribingEventParams",
        "simpleTableColumns": [
          {
            "defaultValue": "",
            "displayName": "Parameter name",
            "name": "name",
            "isUnique": true,
            "type": "TEXT"
          },
          {
            "defaultValue": "",
            "displayName": "Parameter value",
            "name": "value",
            "type": "TEXT"
          }
        ],
        "type": "SIMPLE_TABLE",
        "newRowButtonText": "Add Parameter"
      }
    ]
  },
  {
    "enablingConditions": [
      {
        "paramName": "eventType",
        "type": "EQUALS",
        "paramValue": "trackSocialInteraction"
      }
    ],
    "name": "socialInteractionConfig",
    "type": "GROUP",
    "subParams": [
      {
        "type": "GROUP",
        "name": "socialInteraction",
        "displayName": "Social Interaction",
        "subParams": [
          {
            "name": "socialInteractionParams",
            "simpleTableColumns": [
              {
                "selectItems": [
                  {
                    "displayValue": "action (required)",
                    "value": "action"
                  },
                  {
                    "displayValue": "network (required)",
                    "value": "network"
                  },
                  {
                    "displayValue": "target",
                    "value": "target"
                  }
                ],
                "defaultValue": "action",
                "displayName": "Parameter Name",
                "name": "name",
                "isUnique": true,
                "type": "SELECT"
              },
              {
                "defaultValue": "",
                "displayName": "Parameter Value",
                "name": "value",
                "type": "TEXT"
              }
            ],
            "type": "SIMPLE_TABLE",
            "newRowButtonText": "Add Parameter"
          }
        ],
        "help": "\u003ca href\u003d\"https://docs.snowplow.io/docs/collecting-data/collecting-from-own-applications/javascript-trackers/javascript-tracker/javascript-tracker-v3/tracking-events/#social-tracking\"\u003eRead more\u003c/a\u003e about Social Interaction tracking.",
        "enablingConditions": [
          {
            "paramName": "paramsFromVariable",
            "paramValue": "no",
            "type": "EQUALS"
          }
        ]
      }
    ]
  },
  {
    "help": "\u003ca href\u003d\"https://docs.snowplow.io/docs/collecting-data/collecting-from-own-applications/javascript-trackers/javascript-tracker/javascript-tracker-v3/tracking-events/#ad-tracking-methods\"\u003eRead more\u003c/a\u003e about Ad Tracking.",
    "enablingConditions": [
      {
        "paramName": "eventType",
        "type": "EQUALS",
        "paramValue": "adTracking"
      }
    ],
    "displayName": "Ad Tracking",
    "name": "adTrackingConfig",
    "groupStyle": "NO_ZIPPY",
    "type": "GROUP",
    "subParams": [
      {
        "macrosInSelect": false,
        "selectItems": [
          {
            "displayValue": "Impression",
            "value": "trackAdImpression"
          },
          {
            "displayValue": "Click",
            "value": "trackAdClick"
          },
          {
            "displayValue": "Conversion",
            "value": "trackAdConversion"
          }
        ],
        "displayName": "Ad Tracking Type",
        "defaultValue": "trackAdImpression",
        "simpleValueType": true,
        "name": "adTrackingType",
        "type": "SELECT"
      },
      {
        "enablingConditions": [
          {
            "paramName": "paramsFromVariable",
            "type": "EQUALS",
            "paramValue": "no"
          }
        ],
        "name": "adTrackingParams",
        "simpleTableColumns": [
          {
            "selectItems": [
              {
                "displayValue": "action",
                "value": "action"
              },
              {
                "displayValue": "advertiserId",
                "value": "advertiserId"
              },
              {
                "displayValue": "bannerId",
                "value": "bannerId"
              },
              {
                "displayValue": "campaignId",
                "value": "campaignId"
              },
              {
                "displayValue": "category",
                "value": "category"
              },
              {
                "displayValue": "conversionId",
                "value": "conversionId"
              },
              {
                "displayValue": "clickId",
                "value": "clickId"
              },
              {
                "displayValue": "cost",
                "value": "cost"
              },
              {
                "displayValue": "costModel",
                "value": "costModel"
              },
              {
                "displayValue": "impressionId",
                "value": "impressionId"
              },
              {
                "displayValue": "initialValue",
                "value": "initialValue"
              },
              {
                "displayValue": "property",
                "value": "property"
              },
              {
                "displayValue": "targetUrl",
                "value": "targetUrl"
              },
              {
                "displayValue": "zoneId",
                "value": "zoneId"
              }
            ],
            "defaultValue": "advertiserId",
            "displayName": "Parameter Name",
            "name": "name",
            "isUnique": true,
            "type": "SELECT"
          },
          {
            "defaultValue": "",
            "displayName": "Parameter Value",
            "name": "value",
            "type": "TEXT"
          }
        ],
        "type": "SIMPLE_TABLE",
        "newRowButtonText": "Add Parameter"
      }
    ]
  },
  {
    "help": "\u003ca href\u003d\"https://docs.snowplow.io/docs/collecting-data/collecting-from-own-applications/javascript-trackers/javascript-tracker/javascript-tracker-v3/tracking-events/#trackaddtocartandtrackremovefromcart\"\u003eRead more\u003c/a\u003e about Ecommerce Tracking.",
    "enablingConditions": [
      {
        "paramName": "eventType",
        "type": "EQUALS",
        "paramValue": "cartTracking"
      }
    ],
    "displayName": "Cart Tracking",
    "name": "cartTrackingConfig",
    "groupStyle": "NO_ZIPPY",
    "type": "GROUP",
    "subParams": [
      {
        "selectItems": [
          {
            "displayValue": "Add To Cart",
            "value": "trackAddToCart"
          },
          {
            "displayValue": "Remove From Cart",
            "value": "trackRemoveFromCart"
          }
        ],
        "displayName": "Tracking Type",
        "simpleValueType": true,
        "name": "cartTrackingType",
        "type": "SELECT"
      },
      {
        "enablingConditions": [
          {
            "paramName": "paramsFromVariable",
            "type": "EQUALS",
            "paramValue": "no"
          }
        ],
        "name": "cartTrackingParams",
        "simpleTableColumns": [
          {
            "valueValidators": [],
            "selectItems": [
              {
                "displayValue": "sku (required)",
                "value": "sku"
              },
              {
                "displayValue": "unitPrice (required)",
                "value": "unitPrice"
              },
              {
                "displayValue": "quantity (required)",
                "value": "quantity"
              },
              {
                "displayValue": "name",
                "value": "name"
              },
              {
                "displayValue": "category",
                "value": "category"
              },
              {
                "displayValue": "currency",
                "value": "currency"
              }
            ],
            "defaultValue": "sku",
            "displayName": "Parameter Name",
            "name": "name",
            "isUnique": true,
            "type": "SELECT"
          },
          {
            "defaultValue": "",
            "displayName": "Parameter Value",
            "name": "value",
            "type": "TEXT"
          }
        ],
        "type": "SIMPLE_TABLE",
        "newRowButtonText": "Add Parameter"
      }
    ]
  },
  {
    "enablingConditions": [
      {
        "paramName": "eventType",
        "type": "EQUALS",
        "paramValue": "trackSiteSearch"
      }
    ],
    "name": "siteSearchConfig",
    "type": "GROUP",
    "subParams": [
      {
        "type": "GROUP",
        "name": "siteSearch",
        "displayName": "Site Search",
        "subParams": [
          {
            "name": "siteSearchParams",
            "simpleTableColumns": [
              {
                "selectItems": [
                  {
                    "displayValue": "terms (required)",
                    "value": "terms"
                  },
                  {
                    "displayValue": "filters",
                    "value": "filters"
                  },
                  {
                    "displayValue": "totalResults",
                    "value": "totalResults"
                  },
                  {
                    "displayValue": "pageResults",
                    "value": "pageResults"
                  }
                ],
                "defaultValue": "terms",
                "displayName": "Parameter Name",
                "name": "name",
                "isUnique": true,
                "type": "SELECT"
              },
              {
                "defaultValue": "",
                "displayName": "Parameter Value",
                "name": "value",
                "type": "TEXT"
              }
            ],
            "type": "SIMPLE_TABLE",
            "newRowButtonText": "Add Parameter"
          }
        ],
        "help": "\u003ca href\u003d\"https://docs.snowplow.io/docs/collecting-data/collecting-from-own-applications/javascript-trackers/javascript-tracker/javascript-tracker-v3/tracking-events/#tracksitesearch\"\u003eRead more\u003c/a\u003e about Site Search tracking.",
        "enablingConditions": [
          {
            "paramName": "paramsFromVariable",
            "paramValue": "no",
            "type": "EQUALS"
          }
        ]
      }
    ]
  },
  {
    "enablingConditions": [
      {
        "paramName": "eventType",
        "type": "EQUALS",
        "paramValue": "trackTiming"
      }
    ],
    "name": "timingConfig",
    "type": "GROUP",
    "subParams": [
      {
        "type": "GROUP",
        "name": "timing",
        "displayName": "Timing",
        "subParams": [
          {
            "name": "timingParams",
            "simpleTableColumns": [
              {
                "selectItems": [
                  {
                    "displayValue": "category (required)",
                    "value": "category"
                  },
                  {
                    "displayValue": "variable (required)",
                    "value": "variable"
                  },
                  {
                    "displayValue": "timing (required)",
                    "value": "timing"
                  },
                  {
                    "displayValue": "label",
                    "value": "label"
                  }
                ],
                "defaultValue": "category",
                "displayName": "Parameter Name",
                "name": "name",
                "isUnique": true,
                "type": "SELECT"
              },
              {
                "defaultValue": "",
                "displayName": "Parameter Value",
                "name": "value",
                "type": "TEXT"
              }
            ],
            "type": "SIMPLE_TABLE",
            "newRowButtonText": "Add Parameter"
          }
        ],
        "help": "\u003ca href\u003d\"https://docs.snowplow.io/docs/collecting-data/collecting-from-own-applications/javascript-trackers/javascript-tracker/javascript-tracker-v3/tracking-events/#tracktiming\"\u003eRead more\u003c/a\u003e about tracking Timing hits.",
        "enablingConditions": [
          {
            "paramName": "paramsFromVariable",
            "paramValue": "no",
            "type": "EQUALS"
          }
        ]
      }
    ]
  },
  {
    "enablingConditions": [
      {
        "paramName": "eventType",
        "type": "EQUALS",
        "paramValue": "trackError"
      }
    ],
    "name": "errorConfig",
    "type": "GROUP",
    "subParams": [
      {
        "type": "GROUP",
        "name": "errorTracking",
        "displayName": "Error Tracking",
        "subParams": [
          {
            "name": "errorTrackingParams",
            "simpleTableColumns": [
              {
                "selectItems": [
                  {
                    "displayValue": "message (required)",
                    "value": "message"
                  },
                  {
                    "displayValue": "filename",
                    "value": "filename"
                  },
                  {
                    "displayValue": "lineno",
                    "value": "lineno"
                  },
                  {
                    "displayValue": "colno",
                    "value": "colno"
                  },
                  {
                    "displayValue": "error",
                    "value": "error"
                  }
                ],
                "valueValidators": [],
                "defaultValue": "message",
                "displayName": "Parameter Name",
                "name": "name",
                "isUnique": true,
                "type": "SELECT"
              },
              {
                "defaultValue": "",
                "displayName": "Parameter Value",
                "name": "value",
                "type": "TEXT"
              }
            ],
            "type": "SIMPLE_TABLE",
            "newRowButtonText": "Add Parameter"
          }
        ],
        "help": "\u003ca href\u003d\"https://docs.snowplow.io/docs/collecting-data/collecting-from-own-applications/javascript-trackers/javascript-tracker/javascript-tracker-v3/tracking-events/#error-tracking\"\u003eRead more\u003c/a\u003e about tracking error events.",
        "enablingConditions": [
          {
            "paramName": "paramsFromVariable",
            "paramValue": "no",
            "type": "EQUALS"
          }
        ]
      }
    ]
  },
  {
    "enablingConditions": [
      {
        "paramName": "eventType",
        "type": "EQUALS",
        "paramValue": "trackPageView"
      }
    ],
    "displayName": "Page View Configuration",
    "name": "pageViewConfig",
    "groupStyle": "ZIPPY_OPEN",
    "type": "GROUP",
    "subParams": [
      {
        "selectItems": [
          {
            "displayValue": "Yes",
            "value": true
          },
          {
            "displayValue": "No",
            "value": false
          }
        ],
        "displayName": "Enable Page Activity Tracking",
        "defaultValue": false,
        "simpleValueType": true,
        "name": "pageViewEnablePageActivity",
        "type": "SELECT",
        "subParams": [
          {
            "enablingConditions": [
              {
                "paramName": "pageViewEnablePageActivity",
                "type": "EQUALS",
                "paramValue": true
              }
            ],
            "displayName": "Page Activity Tracking Settings",
            "name": "pageActivityGroup",
            "groupStyle": "ZIPPY_OPEN",
            "type": "GROUP",
            "subParams": [
              {
                "valueValidators": [
                  {
                    "type": "POSITIVE_NUMBER"
                  },
                  {
                    "type": "NON_EMPTY"
                  }
                ],
                "displayName": "Minimum Visit Length",
                "simpleValueType": true,
                "name": "pageViewMinimumVisitLength",
                "valueUnit": "seconds",
                "type": "TEXT"
              },
              {
                "valueValidators": [
                  {
                    "type": "POSITIVE_NUMBER"
                  },
                  {
                    "type": "NON_EMPTY"
                  }
                ],
                "displayName": "Heartbeat Interval",
                "simpleValueType": true,
                "name": "pageViewHeartBeat",
                "valueUnit": "seconds",
                "type": "TEXT"
              },
              {
                "help": "Set this to a Google Tag Manager variable that returns the function you want to invoke as the callback of the page activity ping.",
                "macrosInSelect": true,
                "selectItems": [
                  {
                    "displayValue": "No",
                    "value": "no"
                  }
                ],
                "displayName": "Use Callback Function",
                "simpleValueType": true,
                "name": "pageViewActivityCallback",
                "type": "SELECT"
              }
            ]
          }
        ]
      },
      {
        "displayName": "Custom Page Title",
        "simpleValueType": true,
        "name": "pageViewPageTitle",
        "type": "TEXT",
        "valueHint": "Use current page title"
      },
      {
        "help": "Set this to a Google Tag Manager variable that returns the function you want to execute when assigning a custom context to the Page View and page activity hits.",
        "macrosInSelect": true,
        "selectItems": [
          {
            "displayValue": "No",
            "value": "no"
          }
        ],
        "displayName": "Add Custom Context Function",
        "simpleValueType": true,
        "name": "pageViewPageContextFunction",
        "type": "SELECT"
      }
    ]
  },
  {
    "enablingConditions": [
      {
        "paramName": "eventType",
        "type": "EQUALS",
        "paramValue": "linkTracking"
      }
    ],
    "displayName": "Link Click Tracking Configuration",
    "name": "linkTrackingConfig",
    "groupStyle": "ZIPPY_OPEN",
    "type": "GROUP",
    "subParams": [
      {
        "selectItems": [
          {
            "displayValue": "Enable Automatic Link Click Tracking",
            "value": "enableLinkClickTracking"
          },
          {
            "displayValue": "Track Link Click Event",
            "value": "trackLinkClick"
          }
        ],
        "displayName": "Tracking Type",
        "simpleValueType": true,
        "name": "linkTrackingType",
        "type": "SELECT"
      },
      {
        "enablingConditions": [
          {
            "paramName": "linkTrackingType",
            "type": "EQUALS",
            "paramValue": "enableLinkClickTracking"
          }
        ],
        "name": "linkTrackingEnable",
        "type": "GROUP",
        "subParams": [
          {
            "help": "Add a comma-separated list (or variable that returns an array) of HTML classes. If any of these classes is not on the HTML element when a link click event is triggered, the event will not be tracked. NOTE! This option overrides the Denylist Classes below.",
            "displayName": "Allowlist Classes",
            "simpleValueType": true,
            "name": "linkTrackingAllowlist",
            "type": "TEXT",
            "valueHint": "class1,class2,class3"
          },
          {
            "help": "Add a comma-separated list (or variable that returns an array) of HTML classes. If any of these classes is on the HTML element when a link click event is triggered, the event will not be tracked. NOTE! This option has no effect if Allowlist Classes is specified.",
            "displayName": "Denylist Classes",
            "simpleValueType": true,
            "name": "linkTrackingDenylist",
            "type": "TEXT",
            "valueHint": "class1,class2,class3"
          },
          {
            "help": "Keep this checked to enable proper middle-click tracking on some browsers.",
            "defaultValue": true,
            "simpleValueType": true,
            "name": "linkTrackingPseudoClicks",
            "checkboxText": "Fix Middle-click Tracking",
            "type": "CHECKBOX"
          },
          {
            "help": "Check this box to track the entire HTML content (most often text) of the clicked link with the event.",
            "simpleValueType": true,
            "name": "linkTrackingInnerHTML",
            "checkboxText": "Track HTML Content Of Clicked Link",
            "type": "CHECKBOX"
          }
        ]
      },
      {
        "enablingConditions": [
          {
            "paramName": "linkTrackingType",
            "type": "EQUALS",
            "paramValue": "trackLinkClick"
          }
        ],
        "name": "linkTrackingManual",
        "type": "GROUP",
        "subParams": [
          {
            "name": "linkTrackingParameters",
            "simpleTableColumns": [
              {
                "selectItems": [
                  {
                    "displayValue": "elementClasses",
                    "value": "elementClasses"
                  },
                  {
                    "displayValue": "elementContent",
                    "value": "elementContent"
                  },
                  {
                    "displayValue": "elementId",
                    "value": "elementId"
                  },
                  {
                    "displayValue": "elementTarget",
                    "value": "elementTarget"
                  },
                  {
                    "displayValue": "targetUrl (required)",
                    "value": "targetUrl"
                  }
                ],
                "valueValidators": [],
                "defaultValue": "targetUrl",
                "displayName": "Parameter Name",
                "name": "name",
                "isUnique": true,
                "type": "SELECT"
              },
              {
                "defaultValue": "",
                "displayName": "Parameter Value",
                "name": "value",
                "type": "TEXT"
              }
            ],
            "type": "SIMPLE_TABLE",
            "newRowButtonText": "Add Parameter"
          }
        ]
      }
    ]
  },
  {
    "enablingConditions": [
      {
        "paramName": "eventType",
        "type": "EQUALS",
        "paramValue": "formTracking"
      }
    ],
    "displayName": "Form Tracking Configuration",
    "name": "formTrackingConfig",
    "groupStyle": "ZIPPY_OPEN",
    "type": "GROUP",
    "subParams": [
      {
        "displayName": "Denylist",
        "name": "fromTrackingDenylistGroup",
        "groupStyle": "ZIPPY_CLOSED",
        "type": "GROUP",
        "subParams": [
          {
            "help": "A comma-separated list (or variable that returns an array) of HTML classes. If the \u003cstrong\u003eform\u003c/strong\u003e element has any one of these classes, then the form will not be tracked. NOTE! The form allowlist overrides this field.",
            "displayName": "Denylist Form Classes",
            "simpleValueType": true,
            "name": "formTrackingDenylistForms",
            "type": "TEXT",
            "valueHint": "form1,form2,form2"
          },
          {
            "help": "A comma-separated list (or variable that returns an array) of HTML classes. If the \u003cstrong\u003eform field\u003c/strong\u003e element has any one of these as the value of its \u003cstrong\u003ename\u003c/strong\u003e attribute, then the field will not be tracked. NOTE! The form field allowlist overrides this field.",
            "displayName": "Denylist Form Field Classes",
            "simpleValueType": true,
            "name": "formTrackingDenylistFields",
            "type": "TEXT",
            "valueHint": "field1,field2,field3"
          }
        ]
      },
      {
        "displayName": "Allowlist",
        "name": "formTrackingAllowlistGroup",
        "groupStyle": "ZIPPY_CLOSED",
        "type": "GROUP",
        "subParams": [
          {
            "help": "A comma-separated list (or variable that returns an array) of HTML classes. Only those \u003cstrong\u003eforms\u003c/strong\u003e that have one of these classes will be tracked. NOTE! Overrides the form denylist.",
            "displayName": "Allowlist Form Classes",
            "simpleValueType": true,
            "name": "formTrackingAllowlistForms",
            "type": "TEXT",
            "valueHint": "form1,form2,form3"
          },
          {
            "help": "A comma-separated list (or variable that returns an array) of HTML classes. Only those \u003cstrong\u003eform fields\u003c/strong\u003e that have one of these values as their \u003cstrong\u003ename\u003c/strong\u003e attribute will be tracked. NOTE! Overrides the form field denylist.",
            "displayName": "Allowlist Form Field Classes",
            "simpleValueType": true,
            "name": "formTrackingAllowlistFields",
            "type": "TEXT",
            "valueHint": "field1,field2,field3"
          }
        ]
      }
    ]
  },
  {
    "enablingConditions": [
      {
        "paramName": "eventType",
        "type": "EQUALS",
        "paramValue": "enhancedEcommerce"
      }
    ],
    "displayName": "Enhanced Ecommerce Configuration",
    "name": "enhancedEcommerceConfig",
    "groupStyle": "ZIPPY_OPEN",
    "type": "GROUP",
    "subParams": [
      {
        "help": "Check this to use a \u003ca href\u003d\"https://developers.google.com/tag-manager/enhanced-ecommerce\"\u003eproperly formatted Google Analytics dataLayer object\u003c/a\u003e for populating the Enhanced Ecommerce data. Uncheck this to reference a Google Tag Manager variable which returns the properly formatted object instead.",
        "defaultValue": true,
        "simpleValueType": true,
        "name": "enhancedEcommerceUseDataLayer",
        "checkboxText": "Use Data Layer",
        "type": "CHECKBOX"
      },
      {
        "macrosInSelect": true,
        "selectItems": [],
        "enablingConditions": [
          {
            "paramName": "enhancedEcommerceUseDataLayer",
            "type": "EQUALS",
            "paramValue": false
          }
        ],
        "displayName": "Choose Variable",
        "simpleValueType": true,
        "name": "enhancedEcommerceVariable",
        "type": "SELECT"
      }
    ]
  },
  {
    "type": "GROUP",
    "name": "buttonClickTrackingConfig",
    "displayName": "Filter",
    "groupStyle": "ZIPPY_OPEN",
    "subParams": [
      {
        "type": "SELECT",
        "name": "buttonClickTrackingFilterChoice",
        "displayName": "Filter Type",
        "macrosInSelect": false,
        "selectItems": [
          {
            "value": "allowlist",
            "displayValue": "Allow"
          },
          {
            "value": "denylist",
            "displayValue": "Deny"
          }
        ],
        "simpleValueType": true
      },
      {
        "type": "TEXT",
        "name": "buttonClickTrackingFilters",
        "displayName": "Classes",
        "simpleValueType": true,
        "help": "A comma-seperated list of HTML class names for filtering.",
        "valueHint": "htmlClass, secondHtmlClass"
      }
    ],
    "enablingConditions": [
      {
        "paramName": "eventType",
        "paramValue": "enableButtonClickTracking",
        "type": "EQUALS"
      }
    ]
  },
  {
    "type": "GROUP",
    "name": "enhancedConsentConfig",
    "displayName": "Consent",
    "groupStyle": "ZIPPY_OPEN",
    "subParams": [
      {
        "type": "SELECT",
        "name": "consentType",
        "displayName": "Consent Type",
        "macrosInSelect": false,
        "selectItems": [
          {
            "value": "trackConsentAllow",
            "displayValue": "Allow All"
          },
          {
            "value": "trackConsentSelected",
            "displayValue": "Allow Selected"
          },
          {
            "value": "trackConsentPending",
            "displayValue": "Pending"
          },
          {
            "value": "trackConsentImplicit",
            "displayValue": "Implicit"
          },
          {
            "value": "trackConsentDeny",
            "displayValue": "Deny"
          },
          {
            "value": "trackConsentExpired",
            "displayValue": "Expired"
          },
          {
            "value": "trackConsentWithdrawn",
            "displayValue": "Withdrawn"
          }
        ],
        "simpleValueType": true
      },
      {
        "type": "SELECT",
        "name": "basisForProcessing",
        "displayName": "Basis For Processing",
        "macrosInSelect": false,
        "selectItems": [
          {
            "value": "consent",
            "displayValue": "Consent"
          },
          {
            "value": "contract",
            "displayValue": "Contract"
          },
          {
            "value": "legal_obligation",
            "displayValue": "Legal Obligation"
          },
          {
            "value": "vital_interests",
            "displayValue": "Vital Interests"
          },
          {
            "value": "public_task",
            "displayValue": "Public Task"
          },
          {
            "value": "legitimate_interests",
            "displayValue": "Legitimate Interests"
          }
        ],
        "simpleValueType": true,
        "help": "GDPR lawful basis for data collection \u0026 processing."
      },
      {
        "type": "TEXT",
        "name": "consentUrl",
        "displayName": "Consent URL",
        "simpleValueType": true,
        "help": "URI of the privacy policy related document.",
        "valueHint": "https://www.example.com",
        "valueValidators": [
          {
            "type": "NON_EMPTY"
          }
        ]
      },
      {
        "type": "TEXT",
        "name": "consentVersion",
        "displayName": "Consent Version",
        "simpleValueType": true,
        "help": "Version of the privacy policy related document.",
        "valueHint": "1.0",
        "valueValidators": [
          {
            "type": "STRING_LENGTH",
            "args": [
              1,
              16
            ]
          },
          {
            "type": "NON_EMPTY"
          }
        ]
      },
      {
        "type": "SIMPLE_TABLE",
        "name": "domainsApplied",
        "displayName": "Domains Applied",
        "simpleTableColumns": [
          {
            "defaultValue": "",
            "displayName": "URI",
            "name": "domainAppliedURI",
            "type": "TEXT",
            "valueHint": "https://example.com",
            "isUnique": true,
            "valueValidators": [
              {
                "type": "NON_EMPTY"
              }
            ]
          }
        ],
        "help": "The domains for which this consent allows these preferences to persist to.",
        "valueValidators": [
          {
            "type": "NON_EMPTY"
          }
        ]
      },
      {
        "type": "SELECT",
        "name": "gdprApplies",
        "displayName": "GDPR Applies",
        "macrosInSelect": true,
        "selectItems": [
          {
            "value": true,
            "displayValue": "True"
          },
          {
            "value": false,
            "displayValue": "False"
          }
        ],
        "simpleValueType": true,
        "valueValidators": [
          {
            "type": "NON_EMPTY"
          }
        ],
        "defaultValue": false
      },
      {
        "type": "GROUP",
        "name": "scope",
        "displayName": "Consent Scopes",
        "groupStyle": "NO_ZIPPY",
        "subParams": [
          {
            "type": "SELECT",
            "name": "addGrantedTagConsents",
            "displayName": "Add Tag Manager consent types",
            "macrosInSelect": true,
            "selectItems": [
              {
                "value": true,
                "displayValue": "True"
              },
              {
                "value": false,
                "displayValue": "False"
              }
            ],
            "simpleValueType": true,
            "valueValidators": [
              {
                "type": "NON_EMPTY"
              }
            ],
            "defaultValue": false,
            "help": "Add the granted consent types provided by Tag Manager to Consent Scopes when the event is sent."
          },
          {
            "type": "SIMPLE_TABLE",
            "name": "consentScopes",
            "displayName": "",
            "simpleTableColumns": [
              {
                "defaultValue": "",
                "displayName": "Scopes",
                "name": "consentScope",
                "type": "TEXT",
                "valueValidators": [
                  {
                    "type": "NON_EMPTY"
                  }
                ],
                "isUnique": true,
                "valueHint": ""
              }
            ],
            "help": "The scopes allowed after the user finalized his selection of consent preferences.",
            "valueValidators": [
              {
                "type": "NON_EMPTY"
              }
            ]
          }
        ],
        "help": "The scopes allowed after the user finalized his selection of consent preferences. (e.g. analytics, functional, advertisement)"
      }
    ],
    "enablingConditions": [
      {
        "paramName": "eventType",
        "paramValue": "trackConsent",
        "type": "EQUALS"
      }
    ]
  },
  {
    "enablingConditions": [
      {
        "paramName": "eventType",
        "type": "EQUALS",
        "paramValue": "customCommand"
      }
    ],
    "displayName": "Custom Command",
    "name": "customCommandConfig",
    "groupStyle": "ZIPPY_OPEN",
    "type": "GROUP",
    "subParams": [
      {
        "help": "Enter each custom command on its own row. In the column \u003cstrong\u003eCommand Name\u003c/strong\u003e type the name of the command (e.g. \u003cstrong\u003esetUserId\u003c/strong\u003e), and in the column \u003cstrong\u003eCommand Argument\u003c/strong\u003e type (or provide a variable reference to) the parameter of the command. The commands are executed in order from top to bottom.",
        "displayName": "Custom Commands",
        "name": "customCommandTable",
        "simpleTableColumns": [
          {
            "valueValidators": [
              {
                "type": "NON_EMPTY"
              }
            ],
            "defaultValue": "",
            "displayName": "Command Name",
            "name": "name",
            "type": "TEXT"
          },
          {
            "valueValidators": [
              {
                "errorMessage": "The value must not be empty. If your command accepts no arguments, please use a varable evaluating to undefined instead.",
                "type": "NON_EMPTY"
              }
            ],
            "defaultValue": "",
            "displayName": "Command Argument",
            "name": "args",
            "type": "TEXT"
          }
        ],
        "type": "SIMPLE_TABLE"
      }
    ]
  },
  {
    "enablingConditions": [
      {
        "paramName": "eventType",
        "type": "NOT_EQUALS",
        "paramValue": "customCommand"
      }
    ],
    "displayName": "Additional Tracking Parameters",
    "name": "trackingParamsConfig",
    "groupStyle": "ZIPPY_CLOSED",
    "type": "GROUP",
    "subParams": [
      {
        "help": "Use this table to attach custom context entities to the Snowplow event. Each row can be set to a Google Tag Manager variable that returns an \u003cstrong\u003earray\u003c/strong\u003e of custom contexts to add to the event hit. \u003ca href\u003d\"https://docs.snowplow.io/docs/collecting-data/collecting-from-own-applications/javascript-trackers/javascript-tracker/javascript-tracker-v3/tracking-events/#custom-context\"\u003eRead more\u003c/a\u003e.",
        "displayName": "Add Custom Context Entities",
        "name": "customContexts",
        "simpleTableColumns": [
          {
            "macrosInSelect": true,
            "valueValidators": [
              {
                "type": "NON_EMPTY"
              }
            ],
            "defaultValue": "",
            "displayName": "Context Entities",
            "name": "entitiesVariable",
            "type": "SELECT"
          }
        ],
        "type": "SIMPLE_TABLE"
      },
      {
        "help": "Set this to a UNIX timestamp in case you want to override the default timestamp used by Snowplow. \u003ca href\u003d\"https://docs.snowplow.io/docs/collecting-data/collecting-from-own-applications/javascript-trackers/javascript-tracker/javascript-tracker-v3/tracking-events/#setting-the-true-timestamp\"\u003eRead more\u003c/a\u003e.",
        "displayName": "Set Custom Timestamp",
        "simpleValueType": true,
        "name": "trueTimestamp",
        "valueUnit": "milliseconds (UNIX timestamp)",
        "type": "TEXT",
        "valueHint": "Use system time"
      }
    ]
  },
  {
    "displayName": "Tracker Initialisation",
    "name": "trackerConfiguration",
    "groupStyle": "ZIPPY_CLOSED",
    "type": "GROUP",
    "subParams": [
      {
        "help": "Set to a Google Tag Manager variable of type \"Snowplow v3 Settings\". This is optional - you can configure the tracker either partly or entirely by the overriding settings option below.",
        "macrosInSelect": true,
        "selectItems": [
          {
            "displayValue": "Select a Snowplow v3 Settings variable",
            "value": "select"
          }
        ],
        "displayName": "Snowplow Settings",
        "defaultValue": "select",
        "simpleValueType": true,
        "name": "trackerConfigurationVariable",
        "type": "SELECT"
      },
      {
        "simpleValueType": true,
        "name": "enableOverriding",
        "checkboxText": "Override Tracker Initialisation Parameters",
        "type": "CHECKBOX"
      },
      {
        "enablingConditions": [
          {
            "paramName": "enableOverriding",
            "type": "EQUALS",
            "paramValue": true
          }
        ],
        "displayName": "Please follow the \u003ca href\u003d\"https://docs.snowplow.io/docs/collecting-data/collecting-from-own-applications/javascript-trackers/javascript-tracker/javascript-tracker-v3/tracker-setup/initialization-options\"\u003eofficial documentation\u003c/a\u003e to ensure the values are passed correctly. Anything you set in this table overrides parameters set in the Snowplow Settings variable.",
        "name": "enableOverridingLabel",
        "type": "LABEL"
      },
      {
        "enablingConditions": [
          {
            "paramName": "enableOverriding",
            "type": "EQUALS",
            "paramValue": true
          }
        ],
        "name": "overridingSettings",
        "simpleTableColumns": [
          {
            "selectItems": [
              {
                "displayValue": "appId",
                "value": "appId"
              },
              {
                "displayValue": "platform",
                "value": "platform"
              },
              {
                "displayValue": "respectDoNotTrack",
                "value": "respectDoNot"
              }
            ],
            "defaultValue": "",
            "displayName": "Parameter Name",
            "name": "name",
            "isUnique": true,
            "type": "TEXT"
          },
          {
            "defaultValue": "",
            "displayName": "Parameter Value",
            "name": "value",
            "type": "TEXT"
          }
        ],
        "type": "SIMPLE_TABLE",
        "newRowButtonText": "Add Parameter"
      },
      {
        "help": "Check this box to manually set the tracker name.",
        "simpleValueType": true,
        "name": "overrideTrackerName",
        "checkboxText": "Override Tracker Name",
        "type": "CHECKBOX",
        "subParams": [
          {
            "valueValidators": [
              {
                "type": "NON_EMPTY"
              }
            ],
            "enablingConditions": [
              {
                "paramName": "overrideTrackerName",
                "type": "EQUALS",
                "paramValue": true
              }
            ],
            "defaultValue": "spTracker",
            "simpleValueType": true,
            "name": "trackerName",
            "type": "TEXT"
          }
        ]
      },
      {
        "help": "Check this box to override the collector endpoint URL.",
        "simpleValueType": true,
        "name": "overrideCollectorEndpoint",
        "checkboxText": "Override Collector Endpoint",
        "type": "CHECKBOX",
        "subParams": [
          {
            "valueValidators": [
              {
                "args": [
                  "^\\S+[^/]$"
                ],
                "errorMessage": "You must provide a valid hostname. Please check that no whitespace or trailing slashes are included.",
                "type": "REGEX"
              },
              {
                "type": "NON_EMPTY"
              }
            ],
            "enablingConditions": [
              {
                "paramName": "overrideCollectorEndpoint",
                "type": "EQUALS",
                "paramValue": true
              }
            ],
            "simpleValueType": true,
            "name": "collectorEndpoint",
            "type": "TEXT",
            "valueHint": "e.g. snowplowcollector.mydomain.net"
          }
        ]
      },
      {
        "help": "Check this to manually set the host where the sp.js library should be downloaded from.",
        "simpleValueType": true,
        "name": "overrideLibraryURL",
        "checkboxText": "Override JavaScript Library Host",
        "type": "CHECKBOX",
        "subParams": [
          {
            "enablingConditions": [
              {
                "paramName": "overrideLibraryURL",
                "type": "EQUALS",
                "paramValue": true
              }
            ],
            "displayName": "",
            "name": "trackerGroup",
            "groupStyle": "NO_ZIPPY",
            "type": "GROUP",
            "subParams": [
              {
                "help": "Load the Snowplow JavaScript library from a third-party CDN or choose the location where the self-hosted library can be loaded from. `Do not load` can be used when the Tracker Snippet is loaded with another technique such as directly on the page.",
                "macrosInSelect": false,
                "selectItems": [
                  {
                    "displayValue": "jsDelivr",
                    "value": "jsDelivr"
                  },
                  {
                    "displayValue": "unpkg",
                    "value": "unpkg"
                  },
                  {
                    "displayValue": "Self-hosted",
                    "value": "selfHosted"
                  },
                  {
                    "displayValue": "Do not load library",
                    "value": "doNotLoad"
                  }
                ],
                "displayName": "Snowplow JavaScript Tracker Library",
                "defaultValue": "selfHosted",
                "simpleValueType": true,
                "name": "spLibrary",
                "type": "SELECT"
              },
              {
                "help": "Add the URL where your self-hosted Snowplow JavaScript library can be downloaded from. If this location is not in AWS S3 (via Cloudfront) or GCP Storage, remember to update \u003ca href\u003d\"https://www.simoahava.com/analytics/custom-templates-guide-for-google-tag-manager/#injects-scripts\"\u003e\u003cstrong\u003etemplate permissions\u003c/strong\u003e\u003c/a\u003e to allow script injection requests to this URL.",
                "enablingConditions": [
                  {
                    "paramName": "spLibrary",
                    "type": "EQUALS",
                    "paramValue": "selfHosted"
                  }
                ],
                "valueValidators": [
                  {
                    "type": "NON_EMPTY"
                  },
                  {
                    "args": [
                      "^https://.*"
                    ],
                    "type": "REGEX"
                  }
                ],
                "displayName": "Self-hosted Library URL",
                "simpleValueType": true,
                "name": "selfHostedUrl",
                "type": "TEXT",
                "valueHint": "https://123.cloudfront.net/sp.js"
              },
              {
                "help": "Enter the version of the sp.js library you want to load. You can find more details about library versions \u003ca href\u003d\"https://docs.snowplow.io/docs/collecting-data/collecting-from-own-applications/javascript-trackers/javascript-tracker/third-party-cdn-hosting\"\u003ehere\u003c/a\u003e.",
                "enablingConditions": [
                  {
                    "paramName": "spLibrary",
                    "type": "EQUALS",
                    "paramValue": "unpkg"
                  },
                  {
                    "paramName": "spLibrary",
                    "type": "EQUALS",
                    "paramValue": "jsDelivr"
                  }
                ],
                "valueValidators": [
                  {
                    "type": "NON_EMPTY"
                  },
                  {
                    "args": [
                      "^([3-9]|[1-9][0-9])\\..+$"
                    ],
                    "errorMessage": "The sp.js library version number must be greater or equal to 3 (e.g. 3.1.5).",
                    "type": "REGEX"
                  }
                ],
                "displayName": "Library version",
                "simpleValueType": true,
                "name": "version",
                "type": "TEXT",
                "valueHint": "3.13.0"
              }
            ]
          }
        ]
      }
    ]
  },
  {
    "displayName": "Load Plugins",
    "name": "pluginsConfiguration",
    "groupStyle": "ZIPPY_CLOSED",
    "type": "GROUP",
    "subParams": [
      {
        "displayName": "",
        "name": "pluginsTable",
        "simpleTableColumns": [
          {
            "valueValidators": [
              {
                "type": "NON_EMPTY"
              },
              {
                "args": [
                  "^https?://.+$"
                ],
                "type": "REGEX"
              }
            ],
            "defaultValue": "",
            "displayName": "Plugin URL",
            "name": "url",
            "type": "TEXT"
          },
          {
            "valueValidators": [
              {
                "type": "NON_EMPTY"
              },
              {
                "args": [
                  "^[a-zA-Z]+\\,[a-zA-Z]+$"
                ],
                "errorMessage": "Please enter the configuration in the format \u003cstrong\u003estring1,string2\u003c/strong\u003e. For example: \u003cstrong\u003esnowplowClientHints,ClientHintsPlugin\u003c/strong\u003e.",
                "type": "REGEX"
              }
            ],
            "defaultValue": "",
            "displayName": "Plugin Configuration",
            "name": "config",
            "type": "TEXT",
            "valueHint": "e.g. snowplowClientHints,ClientHintsPlugin"
          },
          {
            "macrosInSelect": true,
            "defaultValue": "",
            "displayName": "Additional Configuration (optional)",
            "name": "additionalConfig",
            "type": "TEXT"
          }
        ],
        "type": "SIMPLE_TABLE"
      }
    ]
  }
]


___SANDBOXED_JS_FOR_WEB_TEMPLATE___

const callInWindow = require('callInWindow');
const copyFromDataLayer = require('copyFromDataLayer');
const copyFromWindow = require('copyFromWindow');
const createQueue = require('createQueue');
const getType = require('getType');
const injectScript = require('injectScript');
const isConsentGranted = require('isConsentGranted');
const log = require('logToConsole');
const makeInteger = require('makeInteger');
const makeNumber = require('makeNumber');
const makeString = require('makeString');
const makeTableMap = require('makeTableMap');
const setInWindow = require('setInWindow');
const templateStorage = require('templateStorage');
const Object = require("Object");

// Constants
const UNPKG =
  'https://unpkg.com/@snowplow/javascript-tracker@' +
  data.version +
  '/dist/sp.js';
const JSDELIVR =
  'https://cdn.jsdelivr.net/npm/@snowplow/javascript-tracker@' +
  data.version +
  '/dist/sp.min.js';
const SNOWPLOW_TRACKER_LIST = 'snowplow_tracker_list';
const ERROR_LOG_PREFIX = '[ERROR GTM / Snowplow v4] ';
const GLOBALNAME = 'snowplow';

const fail = (msg) => {
  log(ERROR_LOG_PREFIX + msg);
  return data.gtmOnFailure();
};

if (data.trackerConfigurationVariable === 'select') {
  fail('Snowplow v4 configuration variable not provided. Check the tracker initilisation option in your tag.');
}

// Create a list of initialized trackers
const trackerList = templateStorage.getItem(SNOWPLOW_TRACKER_LIST) || [];
const pushToTrackerList = (trackerName) => {
  trackerList.push(trackerName);
  templateStorage.setItem(SNOWPLOW_TRACKER_LIST, trackerList);
};

// Build the Snowplow global namespace and return the tracker
const getSp = () => {
  const snowplow = copyFromWindow(GLOBALNAME);
  if (snowplow) {
    return snowplow;
  }

  const globalNamespace = createQueue('GlobalSnowplowNamespace');
  globalNamespace(GLOBALNAME);
  // Can't use createArgumentsQueue here since the Snowplow tracker library
  // does not work with GTM's wrapper
  setInWindow(GLOBALNAME, function () {
    callInWindow('snowplow.q.push', arguments);
  });
  createQueue('snowplow.q');
  return copyFromWindow(GLOBALNAME);
};
const tracker = getSp();

// Helpers
const normalize = (val) => {
  if (val === 'null') return null;
  if (val === 'true') return true;
  if (val === 'false') return false;
  if (makeNumber(val)) return makeNumber(val);
  return val;
};

// Helper to decide if/which library to load.
const decideSpLoadLib = (tagConfig, trackerOptions) => {
  if (tagConfig.overrideLibraryURL) {
    const configOptsMap = {
      jsDelivr: JSDELIVR,
      unpkg: UNPKG,
      doNotLoad: 'doNotLoad',
      selfHosted: tagConfig.selfHostedUrl,
    };

    return configOptsMap[tagConfig.spLibrary];
  }

  const libUrl = trackerOptions ? trackerOptions.libUrl : undefined;
  return libUrl;
};

// Helper that returns a valid tracker configuration object
const getTrackerConfiguration = () => {
  // Fail if invalid variable
  if (
    data.trackerConfigurationVariable !== 'select' &&
    data.trackerConfigurationVariable.type !== 'snowplow'
  ) {
    return false;
  }
  // Return if no parameters added
  if (
    data.trackerConfigurationVariable === 'select' &&
    (!data.overridingSettings || !data.overridingSettings.length)
  ) {
    return {};
  }

  // Set the configuration to the variable return object
  const config = data.trackerConfigurationVariable !== 'select' ? data.trackerConfigurationVariable : {};

  // Override individual fields in the config object from tag settings
  const overrideSettings = data.overridingSettings && data.overridingSettings.length ? makeTableMap(data.overridingSettings, 'name', 'value') : {};
  for (let prop in overrideSettings) {
    config[prop] = overrideSettings[prop];
  }

  // Normalize values
  for (let prop in config) {
    config[prop] = normalize(config[prop]);
  }

  return config;
};

// Helper to create commands with tracker identifier.
// Assumes its argument is string.
const withTrackerId = (trackerIdentifier) => {
  return function (commandName) {
    return commandName + ':' + trackerIdentifier;
  };
};

const config = getTrackerConfiguration();
if (!config) {
  return fail('Could not create a proper tracker configuration object.');
}

// Access the generic settings
const spLoadLib = decideSpLoadLib(data, config.trackerOptions);
const trackerName = data.trackerName || config.trackerOptions.trackerName;
const endpoint =
  data.collectorEndpoint || config.trackerOptions.collectorEndpoint;

if (!spLoadLib) return fail('Missing sp.js library URL');
if (!trackerName) return fail('Missing tracker name');
if (!endpoint) return fail('Missing collector endpoint');

const mkCommand = withTrackerId(trackerName);

// Only initialize the tracker if it hasn't been initialized yet
if (trackerList.indexOf(trackerName) === -1) {
  tracker('newTracker', trackerName, endpoint, config);
  pushToTrackerList(trackerName);
}

// Load plugins, if any.
const plugins = data.pluginsTable || [];
plugins.forEach((plugin) => {
  /* Parse and normalize values in additionalConfig
   * If string with commas, split by comma into an array.
   * If array, return it as-is.
   * If something other than an empty string, undefined, or null, cast into array
   * Otherwise set to undefined.*/
  const additionalConfig = (plugin.additionalConfig.indexOf(',') > -1 ? plugin.additionalConfig.split(',').map(normalize)
                         : (getType(plugin.additionalConfig) === 'array' ? plugin.additionalConfig.map(normalize)
                         : (plugin.additionalConfig !== '' && plugin.additionalConfig !== undefined && plugin.additionalConfig !== null ? [normalize(plugin.additionalConfig)]
                         : undefined)));

  tracker(
    mkCommand('addPlugin'),
    plugin.url,
    plugin.config.split(','),
    additionalConfig
  );
});

/**
 * Adds promoFieldObject context for each promotion in the hit
 *
 * @param {Object} eecObj - The ecommerce object
 * @param {string} key - The ecommerce property to measure promotions
 */
const addPromoCtx = (eecObj, key) => {
  // Assume eecObj[key] exists
  const promotions = eecObj[key].promotions;
  if (getType(promotions) === 'array') {
    promotions.forEach((p) => {
      tracker(mkCommand('addEnhancedEcommercePromoContext'), {
        id: p.id,
        name: p.name,
        creative: p.creative,
        position: p.position,
        currency: eecObj.currencyCode,
      });
    });
  }
};

// Helper for creating Enhanced Ecommerce contexts
const parseEECObject = (obj) => {
  // Valid actions the script will look for in the dataLayer
  const actions = [
    'promoClick',
    'click',
    'detail',
    'add',
    'remove',
    'checkout',
    'checkout_option',
    'purchase',
    'refund',
  ];
  let action;
  // Add an impression context for each impression in the hit
  if (getType(obj.impressions) === 'array') {
    obj.impressions.forEach((i) => {
      tracker(mkCommand('addEnhancedEcommerceImpressionContext'), {
        id: i.id,
        name: i.name,
        list: i.list,
        brand: i.brand,
        category: i.category,
        variant: i.variant,
        position: i.position,
        price: i.price,
        currency: obj.currencyCode,
      });
    });
    action = 'view';
  }
  // According to enhanced ecommerce docs, measuring a promoClick action
  // should be done in a separate hit, after the promoView.
  if (obj.promoView && !obj.promoClick) {
    addPromoCtx(obj, 'promoView');
    action = 'view';
  }
  if (obj.promoClick) {
    addPromoCtx(obj, 'promoClick');
  }
  // Go through all the actions and stop at the first one that matches
  actions.some((a) => {
    // Add a product context for every product in the hit
    if (obj[a] && getType(obj[a].products) === 'array') {
      obj[a].products.forEach((p) => {
        tracker(mkCommand('addEnhancedEcommerceProductContext'), {
          id: p.id,
          name: p.name,
          list: obj[a].actionField ? obj[a].actionField.list : '',
          brand: p.brand,
          category: p.category,
          variant: p.variant,
          price: p.price,
          quantity: p.quantity,
          coupon: p.coupon,
          position: p.position,
          currency: obj.currencyCode,
        });
      });
    }
    // Add an action context for the actionField object
    if (obj[a] && obj[a].actionField) {
      const af = obj[a].actionField;
      tracker(mkCommand('addEnhancedEcommerceActionContext'), {
        id: af.id,
        affiliation: af.affiliation,
        revenue: af.revenue,
        tax: af.tax,
        shipping: af.shipping,
        coupon: af.coupon,
        list: af.list,
        step: af.step,
        option: af.option,
        currency: obj.currencyCode,
      });
    }
    if (obj[a]) {
      // Map the promoClick to its counterpart in Snowplow
      action = a === 'promoClick' ? 'promo_click' : a;
      return true;
    }
  });
  return action;
};

// Initialize the tracker command and the parameters
let commandName = '';
let parameters = {};

// If using event parameter variable, require the variable to return an object
let paramObj;
if (data.paramsFromVariable && data.paramsFromVariable !== 'no') {
  if (getType(data.paramsFromVariable) !== 'object')
    return fail('Parameter variable must return an object.');
  paramObj = data.paramsFromVariable;
}

switch (data.eventType) {
  case 'adTracking':
    if (!paramObj) {
      // If parameters are set manually
      paramObj = data.adTrackingParams;
      if (!paramObj || !paramObj.length)
        return fail('No parameters provided for ad tracking hit!');
      paramObj = makeTableMap(paramObj, 'name', 'value');
    }
    // Validate hit
    if (
      paramObj.costModel &&
      ['cpa', 'cpc', 'cpm'].indexOf(paramObj.costModel) === -1
    )
      return fail('Invalid value for "costModel" in ad tracking hit.');
    if (data.adTrackingType === 'trackAdClick' && !paramObj.targetUrl)
      return fail('Missing "targetUrl" in ad tracking hit.');

    commandName = data.adTrackingType;
    parameters = paramObj;
    break;
    
  case 'cartTracking':
    if (!paramObj) {
      paramObj = data.cartTrackingParams;
      if (!paramObj || !paramObj.length)
        return fail('No parameters provided for cart tracking hit!');
      paramObj = makeTableMap(paramObj, 'name', 'value');
    }
    // Validate hit
    if (!paramObj.sku) return fail('Missing "sku" from cart tracking hit.');
    if (!paramObj.unitPrice)
      return fail('Missing "unitPrice" from cart tracking hit.');
    if (!paramObj.quantity)
      return fail('Missing "quantity" from cart tracking hit.');

    commandName = data.cartTrackingType;
    parameters = paramObj;
    break;
    
  case 'trackError':
    if (!paramObj) {
      paramObj = data.errorTrackingParams;
      if (!paramObj || !paramObj.length)
        return fail('No parameters provided for error tracking hit!');
      paramObj = makeTableMap(paramObj, 'name', 'value');
    }
    // Validate hit
    if (!paramObj.message)
      return fail('Missing "message" from error tracking hit.');

    commandName = data.eventType;
    parameters = paramObj;
    break;
    
  case 'trackSiteSearch':
    if (!paramObj) {
      paramObj = data.siteSearchParams;
      if (!paramObj || !paramObj.length)
        return fail('No parameters provided for site search hit!');
      paramObj = makeTableMap(paramObj, 'name', 'value');
    }
    // Validate hit
    if (!paramObj.terms) return fail('Missing "terms" from site search hit.');
    if (paramObj.filters && getType(paramObj.filters) !== 'object')
      return fail('"filters" in the site search hit should be an object.');

    // Normalize terms
    if (getType(paramObj.terms) === 'string')
      paramObj.terms = paramObj.terms.split(',').map((t) => t.trim());

    commandName = data.eventType;
    parameters = paramObj;
    break;
    
  case 'trackPageView':
    if (data.pageViewEnablePageActivity) {
      const callback = data.pageViewActivityCallback !== 'no' && getType(data.pageViewActivityCallback) === 'function' ? data.pageViewActivityCallback : null;
      // Call the activity tracking method *before* sending the pageview
      tracker(
        mkCommand(
          callback ? 'enableActivityTrackingCallback' : 'enableActivityTracking'
        ),
        {
          minimumVisitLength: makeInteger(data.pageViewMinimumVisitLength),
          heartbeatDelay: makeInteger(data.pageViewHeartBeat),
          callback: callback,
        }
      );
    }

    if (
      data.pageViewPageContextFunction !== 'no' &&
      getType(data.pageViewPageContextFunction) === 'function'
    ) {
      parameters.contextCallback = data.pageViewPageContextFunction;
    }

    commandName = data.eventType;
    parameters.title = data.pageViewPageTitle;
    break;
    
  case 'trackStructEvent':
    if (!paramObj) {
      paramObj = data.structEventParams;
      if (!paramObj || !paramObj.length)
        return fail('No parameters provided for structured event hit!');
      paramObj = makeTableMap(paramObj, 'name', 'value');
    }
    // Validate hit
    if (!paramObj.category)
      return fail('Missing "category" from structured event hit.');
    if (!paramObj.action)
      return fail('Missing "action" from structured event hit.');

    commandName = data.eventType;
    parameters = paramObj;
    break;
    
  case 'trackSelfDescribingEvent':
    if (!paramObj) {
      paramObj = data.selfDescribingEventParams || [];
      paramObj = paramObj.length ? makeTableMap(paramObj, 'name', 'value') : {};
    }
    // Validate hit
    if (!data.selfDescribingEventSchemaUrl)
      return fail('No schema URL set for self-describing event.');

    commandName = data.eventType;
    parameters = {
      event: {
        schema: data.selfDescribingEventSchemaUrl,
        data: paramObj,
      },
    };
    break;
    
  case 'trackSocialInteraction':
    if (!paramObj) {
      paramObj = data.socialInteractionParams;
      if (!paramObj || !paramObj.length)
        return fail('No parameters provided for social interaction hit!');
      paramObj = makeTableMap(paramObj, 'name', 'value');
    }
    // Validate hit
    if (!paramObj.action)
      return fail('Missing "action" from social interaction hit.');
    if (!paramObj.network)
      return fail('Missing "network" from social interaction hit.');

    commandName = data.eventType;
    parameters = paramObj;
    break;
    
  case 'linkTracking':
    if (data.linkTrackingType === 'enableLinkClickTracking') {
      const filter = {};
      // Use allowlist if available, denylist if not
      if (data.linkTrackingAllowlist || data.linkTrackingDenylist) {
        let filterValue =
          data.linkTrackingAllowlist || data.linkTrackingDenylist;
        // Convert comma-separated string to an array
        filterValue =
          filterValue && getType(filterValue) === 'string' ? filterValue.split(',').map((f) => f.trim()) : filterValue;
        if (filterValue)
          filter[data.linkTrackingAllowlist ? 'allowlist' : 'denylist'] =
            filterValue;
      }

      commandName = data.linkTrackingType;
      parameters = {
        options: filter,
        pseudoClicks: !!data.linkTrackingPseudoClicks,
        trackContent: !!data.linkTrackingInnerHTML,
      };
    } else {
      const params =
        data.linkTrackingParameters && data.linkTrackingParameters.length ? makeTableMap(data.linkTrackingParameters, 'name', 'value') : null;
      let classes;
      // Validate hit
      if (!params)
        return fail('No parameters passed to link click tracking hit.');
      if (!params.targetUrl)
        return fail('Missing "targetUrl" from link click tracking hit.');
      // Normalize elementClasses to array (split and trim if string)
      if (params.elementClasses) {
        if (getType(params.elementClasses === 'array'))
          classes = params.elementClasses;
        if (getType(params.elementClasses === 'string'))
          classes = params.elementClasses.split(',').map((c) => c.trim());
      }

      commandName = data.linkTrackingType;
      parameters = {
        targetUrl: params.targetUrl,
        elementId: params.elementId,
        elementClasses: classes,
        elementTarget: params.elementTarget,
        elementContent: params.elementContent,
      };
    }
    break;
  
  case 'formTracking':
    const formConfig = {
      forms: {},
      fields: {},
    };
    let filterForm =
      data.formTrackingAllowlistForms || data.formTrackingDenylistForms;
    let filterField =
      data.formTrackingAllowlistFields || data.formTrackingDenylistFields;
    if (getType(filterForm) === 'string')
      filterForm = filterForm.split(',').map((f) => f.trim());
    if (getType(filterField) === 'string')
      filterField = filterField.split(',').map((f) => f.trim());
    if (getType(filterForm) === 'array')
      formConfig.forms[
        data.formTrackingAllowlistForms ? 'allowlist' : 'denylist'
      ] = filterForm;
    if (getType(filterField) === 'array')
      formConfig.fields[
        data.formTrackingAllowlistFields ? 'allowlist' : 'denylist'
      ] = filterField;

    commandName = 'enableFormTracking';
    parameters = {
      options: formConfig,
    };
    break;
    
  case 'trackTiming':
    if (!paramObj) {
      paramObj = data.timingParams;
      if (!paramObj || !paramObj.length)
        return fail('No parameters provided for timing hit!');
      paramObj = makeTableMap(paramObj, 'name', 'value');
    }
    // Validate hit
    if (!paramObj.category) return fail('Missing "category" from timing hit.');
    if (!paramObj.variable) return fail('Missing "variable" from timing hit.');
    if (!paramObj.timing) return fail('Missing "timing" from timing hit.');

    commandName = data.eventType;
    parameters = paramObj;
    break;
    
  case 'enhancedEcommerce':
    let ecom;
    // Use dataLayer if available, otherwise use variable
    if (data.enhancedEcommerceUseDataLayer) {
      ecom = copyFromDataLayer('ecommerce', 1);
    } else {
      ecom =
        getType(data.enhancedEcommerceVariable) === 'object' ? data.enhancedEcommerceVariable.ecommerce : null;
    }
    // Validate hit
    if (!ecom) return fail('No valid "ecommerce" object found');
    const action = parseEECObject(ecom);
    if (action) {
      commandName = 'trackEnhancedEcommerceAction';
      parameters = {
        action: action,
      };
    } else {
      return fail('Unable to track any valid Enhanced Ecommerce event.');
    }
    break;
    
  case 'enableButtonClickTracking':
    let filters = data.buttonClickTrackingFilters;
    // Enable tracking with no filter if not present
    if (data.buttonClickTrackingFilters === undefined) {
      commandName = data.eventType;
      break;
    }
    
    // Don't enable tracking for any other falsey values
    if (!data.buttonClickTrackingFilters) {
      return fail("Invalid value '" + filters + "' for button click filters");
    }
    
    const filterType = getType(filters);
    if (filterType === "string") {
      filters = data.buttonClickTrackingFilters
      .trim()
      .split(",")
      .map(f => f.trim());
      
    // The filter can be set with a variable, if it's an array we check that all elements are strings
    } else if (filterType === 'array') {
      const isStringArray = filters.every(f => getType(f) === "string");
      if (isStringArray) {
        filters = data.buttonClickTrackingFilters;
      } else {
        return fail("Non-string value present in filter array provided.");
      }

    // Reject any other type 
    } else {
      return fail(
        "Unsupported type '" + filterType + "' for button click filter."
      ); 
    }

    // An empty filter array would result in no events, as there is
    // nothing in the array for the button classes to check against
    if (!filters.length) {
      break;
    }
    
    // Only set commandName once we have a valid filter list
    commandName = data.eventType;
    const choice = data.buttonClickTrackingFilterChoice;
    const filter = {};
    filter[choice] = filters;
    parameters = {filter: filter};

    break;
    
  case 'trackConsent':
    const required = [
      'consentScopes',
      'basisForProcessing',
      'consentUrl',
      'consentVersion',
      'domainsApplied',
     ];
    
    const undefinedValues = required.filter(r => data[r] === undefined);
    if (undefinedValues.length) {
      return fail('Undefined fields in Consent tracking: ' + undefinedValues);
    }
      
    commandName = data.consentType;
    
    // Domains/Scopes will be a list of single-element objects from the input table
    // Parses:
    // [{foo: 'bar'}, {foo: 'baz'}]
    // to
    // ['bar', 'baz']
    //
    // Or if the value is an array, will flatten:
    // [{foo: ['bar', 'baz'], {foo: 'faz'}]
    // to
    // ['bar', 'baz', 'faz']
    const domains = data.domainsApplied.reduce((a, x) => {
      x = Object.values(x)[0];
      return getType(x) === 'array' ? a.concat(x) : a.concat([x]);
    }, []);
    
    const scopes = data.consentScopes
    .reduce((a, x) => {
      x = Object.values(x)[0];
      return getType(x) === 'array' ? a.concat(x) : a.concat([x]);
    }, [])
    .concat(data.addGrantedTagConsents ? [
      "ad_storage",
      "analytics_storage",
      "functionality_storage",
      "personalization_storage",
      "security_storage",
    ].filter(isConsentGranted) : []);

    parameters = {
      consentScopes: scopes,
      basisForProcessing: data.basisForProcessing,
      consentUrl: data.consentUrl,
      consentVersion: data.consentVersion,
      domainsApplied: domains,
      gdprApplies: normalize(data.gdprApplies),
    };

    break;

  case 'customCommand':
    // Process custom commands and send each to tracker object with provided arguments
    const commands =
      data.customCommandTable && data.customCommandTable.length ? data.customCommandTable : [];
    commands.forEach((c) => {
      tracker(mkCommand(c.name), c.args);
    });
    break;
}




const mkCustomContexts = (tagConfig) => {
  const zeroVal = [];
  const configCtx = tagConfig.customContexts;
  if (configCtx && configCtx.length > 0) {
    return configCtx.reduce((acc, curr) => {
      const ctx = curr.entitiesVariable;
      if (getType(ctx) === 'array') {
        return acc.concat(ctx);
      }
      // if not array, ignore
      return acc;
    }, zeroVal);
  }
  return zeroVal;
};

if (data.eventType !== 'customCommand') {
  // Add custom contexts
  const contextToAdd = mkCustomContexts(data);
  if (contextToAdd.length > 0) {
    parameters.context = contextToAdd;
  }

  // Add true timestamp
  if (data.trueTimestamp)
    parameters.timestamp = { type: 'ttm', value: data.trueTimestamp };

  // Execute the command
  tracker(mkCommand(commandName), parameters);
}

if (spLoadLib !== 'doNotLoad') {
  injectScript(spLoadLib, data.gtmOnSuccess, data.gtmOnFailure, 'splibrary');
} else {
  data.gtmOnSuccess();
}


___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "access_globals",
        "versionId": "1"
      },
      "param": [
        {
          "key": "keys",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "GlobalSnowplowNamespace"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": false
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "snowplow"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": false
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "snowplow.q"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": false
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "_snowplow_trackers"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": false
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "snowplow.q.push"
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "snowplow.apply"
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "inject_script",
        "versionId": "1"
      },
      "param": [
        {
          "key": "urls",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "https://*.cloudfront.net/*"
              },
              {
                "type": 1,
                "string": "https://storage.googleapis.com/*"
              },
              {
                "type": 1,
                "string": "https://cdn.jsdelivr.net/*"
              },
              {
                "type": 1,
                "string": "https://unpkg.com/*"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "debug"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "read_data_layer",
        "versionId": "1"
      },
      "param": [
        {
          "key": "allowedKeys",
          "value": {
            "type": 1,
            "string": "specific"
          }
        },
        {
          "key": "keyPatterns",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "ecommerce"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "access_template_storage",
        "versionId": "1"
      },
      "param": []
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "access_consent",
        "versionId": "1"
      },
      "param": [
        {
          "key": "consentTypes",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "consentType"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "ad_storage"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": false
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "consentType"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "analytics_storage"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": false
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "consentType"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "functionality_storage"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": false
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "consentType"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "personalization_storage"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": false
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "consentType"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "security_storage"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": false
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios:
- name: Tracker configuration loaded from parameters, overrides variable
  code: |
    mockData.trackerName = undefined;
    mockData.trackerConfigurationVariable = {
      appId: 'test',
      type: 'snowplow',
      platform: 'ios',
      trackerOptions: { trackerName: 'testName' },
    };
    mockData.overridingSettings = [{ name: 'platform', value: 'web' }];
    mock('copyFromWindow', (key) => {
      if (key === mockData.globalName) {
        return function () {
          if (arguments[0] === 'newTracker') {
            assertThat(arguments[1], 'Tracker name not overridden').isEqualTo(
              'testName'
            );
            assertThat(arguments[3], 'Variable config not overridden').isEqualTo({
              appId: 'test',
              type: 'snowplow',
              platform: 'web',
              trackerOptions: { trackerName: 'testName' },
            });
          }
        };
      }
    });

    // Call runCode to run the template's code.
    runCode(mockData);

    // Verify that the tag finished successfully.
    assertApi('gtmOnSuccess').wasCalled();
- name: Custom command called with arguments
  code: |
    mockData.eventType = 'customCommand';
    mockData.customCommandTable = [{ name: 'commandName', args: 'commandValue' }];

    mock('copyFromWindow', (key) => {
      if (key === mockData.globalName) {
        return (command, parameters) => {
          if (command === 'newTracker') return;
          assertThat(command, 'Invalid command name').isEqualTo(
            'commandName' + ':' + mockData.trackerName
          );
          assertThat(parameters, 'Invalid parameter sent').isEqualTo(
            'commandValue'
          );
        };
      }
    });

    // Call runCode to run the template's code.
    runCode(mockData);

    // Verify that the tag finished successfully.
    assertApi('gtmOnSuccess').wasCalled();
- name: Context added to hit
  code: |
    const userEntity = {
      schema: 'iglu:com.google.tag-manager.server-side/user_data/jsonschema/1-0-0',
      data: { email_address: 'foo@bar.io' },
    };
    const mobileEntity = {
      schema: 'iglu:com.snowplowanalytics.snowplow/mobile_context/jsonschema/1-0-2',
      data: {
        osType: 'myOsType',
        osVersion: 'myOsVersion',
        deviceManufacturer: 'myDevMan',
        deviceModel: 'myDevModel',
      },
    };

    mockData.eventType = 'trackPageView';
    mockData.pageViewPageTitle = 'test';
    mockData.pageViewPageContextFunction = () => {};
    mockData.customContexts = [
      { entitiesVariable: [userEntity] },
      { entitiesVariable: [mobileEntity] },
      { entitiesVariable: 'ignore' },
    ];
    mockData.trueTimestamp = 123;

    mock('copyFromWindow', (key) => {
      if (key === mockData.globalName) {
        return (command, parameters) => {
          if (command === 'newTracker') return;
          assertThat(command, 'Invalid command name').isEqualTo(
            mockData.eventType + ':' + mockData.trackerName
          );
          assertThat(parameters.title, 'Invalid title set').isEqualTo(
            mockData.pageViewPageTitle
          );
          assertThat(parameters.context, 'Invalid context set length').hasLength(2);
          assertThat(parameters.context, 'Invalid context set').contains(
            userEntity
          );
          assertThat(parameters.context, 'Invalid context set').contains(
            mobileEntity
          );
          assertThat(
            parameters.contextCallback,
            'Invalid context callback set'
          ).isEqualTo(mockData.pageViewPageContextFunction);
          assertThat(parameters.timestamp.value, 'Invalid timestamp set').isEqualTo(
            mockData.trueTimestamp
          );
        };
      }
    });

    // Call runCode to run the template's code.
    runCode(mockData);

    // Verify that the tag finished successfully.
    assertApi('gtmOnSuccess').wasCalled();
- name: Enhanced Ecommerce works with Use Data Layer
  code: |
    mockData.eventType = 'enhancedEcommerce';
    mockData.enhancedEcommerceUseDataLayer = true;
    let impression = false;
    let promo = false;

    mock('copyFromDataLayer', (key, version) => {
      if (key === 'ecommerce' && version === 1) {
        return {
          impressions: [
            {
              id: 'impression1',
            },
          ],
          promoView: {
            promotions: [
              {
                id: 'promo1',
              },
            ],
          },
        };
      }
    });

    mock('copyFromWindow', (key) => {
      if (key === mockData.globalName) {
        return (command, parameters) => {
          if (command === 'newTracker') return;
          if (
            command === 'addEnhancedEcommerceImpressionContext:test' &&
            parameters.id === 'impression1'
          )
            impression = true;
          if (
            command === 'addEnhancedEcommercePromoContext:test' &&
            parameters.id === 'promo1'
          )
            promo = true;
        };
      }
    });

    // Call runCode to run the template's code.
    runCode(mockData);

    // Verify that the tag finished successfully.
    assertThat(
      impression,
      'Enhanced Ecommerce failed - incorrect impression parsing'
    ).isEqualTo(true);
    assertThat(
      promo,
      'Enhanced Ecommerce failed - incorrect promo parsing'
    ).isEqualTo(true);

    assertApi('gtmOnSuccess').wasCalled();
- name: Plugin loaded
  code: |
    mockData.pluginsTable = [
      {
        url: 'https://www.url.com',
        config: 'somePlugin,PluginSome',
        additionalConfig: 'true,true,true',
      },
    ];

    mock('copyFromWindow', (key) => {
      if (key === mockData.globalName) {
        return (command, param1, param2, param3) => {
          if (command !== 'addPlugin') return;
          assertThat(command, 'Invalid command name').isEqualTo('addPlugin');
          assertThat(param1, 'Invalid parameter for url').isEqualTo(
            'https://www.url.com'
          );
          assertThat(param2, 'Invalid parameter for config').isEqualTo([
            'somePlugin',
            'PluginSome',
          ]);
          assertThat(param3, 'Invalid parameter for additionalConfig').isEqualTo([
            true,
            true,
            true,
          ]);
        };
      }
    });

    // Call runCode to run the template's code.
    runCode(mockData);

    // Verify that the tag finished successfully.
    assertApi('gtmOnSuccess').wasCalled();
- name: No load lib
  code: |
    mockData.overrideLibraryURL = false;
    mockData.spLibrary = undefined;
    mockData.version = undefined;
    mockData.selfHostingUrl = undefined;
    mockData.trackerConfigurationVariable = {
      type: 'snowplow',
      trackerOptions: { libUrl: 'doNotLoad' },
    };

    runCode(mockData);
    assertApi('injectScript').wasNotCalled();
- name: Test unpkg CDN url
  code: |
    mockData.overrideLibraryURL = true;
    mockData.spLibrary = 'unpkg';
    mockData.version = '3.8.0';
    mockData.selfHostingUrl = undefined;

    let url = '';
    mock('injectScript', function(injectUrl, x, y, z) {
      url = injectUrl;
    });

    runCode(mockData);
    assertApi('injectScript').wasCalled();

    const expectedUnpkgUrl = 'https://unpkg.com/@snowplow/javascript-tracker@3.8.0/dist/sp.js';
    assertThat(url).isStrictlyEqualTo(expectedUnpkgUrl);
- name: Enhanced Ecommerce promoView
  code: |
    mockData.eventType = 'enhancedEcommerce';
    mockData.enhancedEcommerceUseDataLayer = true;

    mock('copyFromDataLayer', (key, version) => {
      if (key === 'ecommerce' && version === 1) {
        return {
          currencyCode: 'FOO',
          promoView: {
            promotions: [
              {
                id: 'test_a_campaign',
                name: 'Test A Campaign',
                creative: 'Carousel',
                position: 'Slide 1',
              },
              {
                id: 'test_b_campaign',
                name: 'Test B Campaign',
                creative: 'Carousel',
                position: 'Slide 2',
              },
            ],
          },
        };
      }
    });

    const expectedEECCommands = [
      {
        cmd: 'addEnhancedEcommercePromoContext:' + mockData.trackerName,
        params: {
          id: 'test_a_campaign',
          name: 'Test A Campaign',
          creative: 'Carousel',
          position: 'Slide 1',
          currency: 'FOO',
        },
      },
      {
        cmd: 'addEnhancedEcommercePromoContext:' + mockData.trackerName,
        params: {
          id: 'test_b_campaign',
          name: 'Test B Campaign',
          creative: 'Carousel',
          position: 'Slide 2',
          currency: 'FOO',
        },
      },
      {
        cmd: 'trackEnhancedEcommerceAction:' + mockData.trackerName,
        params: {
          action: 'view',
        },
      },
    ];

    const actualCommands = [];
    mock('copyFromWindow', (key) => {
      if (key === mockData.globalName) {
        return (command, parameters) => {
          if (command !== 'newTracker') {
            actualCommands.push({
              cmd: command,
              params: parameters,
            });
          }
        };
      }
    });

    // Call runCode to run the template's code.
    runCode(mockData);
    assertThat(actualCommands).isEqualTo(expectedEECCommands);
    assertApi('gtmOnSuccess').wasCalled();
- name: Enhanced Ecommerce promoClick
  code: |
    mockData.eventType = 'enhancedEcommerce';
    mockData.enhancedEcommerceUseDataLayer = true;

    mock('copyFromDataLayer', (key, version) => {
      if (key === 'ecommerce' && version === 1) {
        return {
          currencyCode: 'FOO',
          promoClick: {
            promotions: [
              {
                id: 'test_a_campaign',
                name: 'Test A Campaign',
                creative: 'Carousel',
                position: 'Slide 1',
              },
              {
                id: 'test_b_campaign',
                name: 'Test B Campaign',
                creative: 'Carousel',
                position: 'Slide 2',
              },
            ],
          },
        };
      }
    });

    const expectedEECCommands = [
      {
        cmd: 'addEnhancedEcommercePromoContext:' + mockData.trackerName,
        params: {
          id: 'test_a_campaign',
          name: 'Test A Campaign',
          creative: 'Carousel',
          position: 'Slide 1',
          currency: 'FOO',
        },
      },
      {
        cmd: 'addEnhancedEcommercePromoContext:' + mockData.trackerName,
        params: {
          id: 'test_b_campaign',
          name: 'Test B Campaign',
          creative: 'Carousel',
          position: 'Slide 2',
          currency: 'FOO',
        },
      },
      {
        cmd: 'trackEnhancedEcommerceAction:' + mockData.trackerName,
        params: {
          action: 'promo_click',
        },
      },
    ];

    const actualCommands = [];
    mock('copyFromWindow', (key) => {
      if (key === mockData.globalName) {
        return (command, parameters) => {
          if (command !== 'newTracker') {
            actualCommands.push({
              cmd: command,
              params: parameters,
            });
          }
        };
      }
    });

    // Call runCode to run the template's code.
    runCode(mockData);
    assertThat(actualCommands).isEqualTo(expectedEECCommands);
    assertApi('gtmOnSuccess').wasCalled();
- name: Button Click Tracking
  code: "mockData.eventType = \"enableButtonClickTracking\";\nmockData.buttonClickTrackingFilterChoice\
    \ = \"allowlist\";\n\nconst check = (input, expected) => {\n  mockData.buttonClickTrackingFilters\
    \ = input;\n  mock('copyFromWindow', (key) => {\n    if (key === mockData.globalName)\
    \ {\n      return (command, parameters) => {\n        if (command === 'newTracker')\
    \ return;\n        // Command should only be set if there's a value for the filter\
    \ list, or the filter list is not set by the user (undefined).\n        if (expected.filter\
    \ || input === undefined) { assertThat(command).isEqualTo(\"enableButtonClickTracking:test\"\
    );\n                                                       }\n        else {\n\
    \          assertThat(command).isEqualTo(\":test\");\n        }\n        assertThat(parameters).isEqualTo(expected);\n\
    \      };\n    }\n  });\n\n  runCode(mockData);\n};\n\n// String should get split\
    \ by ','\ncheck('a,b,c', {filter: {allowlist: [\"a\", \"b\", \"c\"]}});\n\n//\
    \ Empty string - no filter\ncheck('', {});\n\n// Array should be used as-is if\
    \ all elements strings\ncheck(['a', 'b', 'c'], {filter: {allowlist: [\"a\", \"\
    b\", \"c\"]}});\n\n// Empty array - no filter\ncheck([], {});\n\n// Array with\
    \ non-string values - no filter\ncheck(['a', 1], {});\n\n// Any other types -\
    \ no filter\ncheck(undefined, {});\ncheck(1, {});\ncheck({}, {});\n\n   "
setup: |-
  const log = require('logToConsole');

  const mockData = {
    trackerName: 'test',
    overrideLibraryURL: true,
    spLibrary: 'selfHosted',
    selfHostedUrl: 'https://abcd.cloudfront.net/sp.js',
    globalName: 'snowplow',
    collectorEndpoint: 'test.domain',
    trackerConfigurationVariable: 'select',
    overridingSettings: [],
  };

  let success, failure;
  mock('injectScript', (url, onsuccess, onfailure) => {
    success = onsuccess;
    failure = onfailure;
    if (url === mockData.selfHostedUrl) {
      onsuccess();
    } else {
      onfailure();
    }
    return;
  });


___NOTES___

Created on 16/08/2019, 09:46:49


